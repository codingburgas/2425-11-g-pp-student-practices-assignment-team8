<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}EduAlign{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary: #fdd835;
            --background: #121212;
            --surface: #1f1f1f;
            --text: #ffffff;
            --muted: #888888;
        }

        body {
            background-color: var(--background);
            color: var(--text);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        a {
            color: var(--primary);
            text-decoration: none;
        }

        a:hover {
            color: #fff176;
        }

        .navbar {
            background-color: var(--surface);
            box-shadow: 0 2px 10px rgba(255, 255, 255, 0.05);
        }

        .navbar-brand, .nav-link, .dropdown-item {
            color: var(--text) !important;
        }

        .nav-link.active, .dropdown-item:hover {
            background-color: var(--primary);
            color: var(--background) !important;
        }

        .navbar-toggler-icon {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23fdd835' viewBox='0 0 30 30'%3e%3cpath stroke='rgba(253,216,53, 1)' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
        }

        .dropdown-menu {
            background-color: var(--surface);
            border: none;
        }

        .dropdown-item {
            color: var(--text);
        }

        /* Make search suggestion text darker on hover */
        #search-suggestions .dropdown-item:hover {
            background-color: var(--primary);
        }

        #search-suggestions .dropdown-item:hover .text-warning {
            color: #000 !important;
        }

        .navbar-search .form-control {
            background-color: var(--background);
            color: var(--text);
            border: 1px solid var(--primary);
            border-radius: 15px 0 0 15px;
        }

        .navbar-search .btn {
            background-color: var(--primary);
            border: none;
            color: var(--background);
            border-radius: 0 15px 15px 0;
        }

        .btn-outline-primary {
            color: var(--primary);
            border-color: var(--primary);
        }

        .btn-outline-primary:hover {
            background-color: var(--primary);
            color: var(--background);
        }

        .btn-primary {
            background-color: var(--primary);
            border-color: var(--primary);
            color: var(--background);
        }

        .alert {
            background-color: #333;
            color: var(--primary);
            border-color: var(--primary);
        }

        .alert-success {
            background-color: #28a745;
            color: white;
            border-color: #28a745;
            font-weight: bold;
            position: relative;
        }

        .alert-success .close-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            font-size: 1.2rem;
        }

        footer {
            background-color: var(--surface);
            color: var(--text);
        }

        table {
            color: var(--text);
        }

        thead {
            background-color: var(--primary);
            color: var(--background);
        }

        .form-control, .form-check-input, .form-select, textarea {
            background-color: var(--surface);
            border: 1px solid var(--primary);
            color: var(--text);
        }

        .form-check-label {
            color: var(--text);
        }

        .btn-check:checked + .btn-outline-primary {
            background-color: var(--primary);
            color: var(--background);
            border-color: var(--primary);
        }
        .form-control {
            background-color: var(--surface); /* dark background */
            border: 1px solid var(--primary); /* yellow border */
            color: var(--primary); /* yellow text */
        }

        /* Ensure focus doesn't change appearance */
        .form-control:focus {
            background-color: var(--surface);  /* keep background dark */
            color: var(--primary);             /* keep text yellow */
            border-color: var(--primary);      /* keep border yellow */
            box-shadow: none;                  /* remove blue shadow */
        }

        /* Optional: Style placeholder text if needed */
        .form-control::placeholder {
            color: var(--muted); /* lighter gray for placeholder */
        }

        #search-suggestions {
            max-height: 300px;
            overflow-y: auto;
            overflow-x: hidden;
            width: 100%;
        }


    </style>
    {% block extra_css %}{% endblock %}
</head>
<body>
    <nav class="navbar navbar-expand-lg py-3">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="{{ url_for('main_bp.index') }}">
                <img src="{{ url_for('static', filename='images/logo2.png') }}" alt="EduAlign Logo" width="30" height="30" class="me-2">
                <span class="text-warning">EduAlign</span>
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link {% if request.path == url_for('main_bp.index') %}active{% endif %}" href="{{ url_for('main_bp.index') }}">
                            <i class="bi bi-house-door me-1"></i>Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if request.path == url_for('main_bp.about') %}active{% endif %}" href="{{ url_for('main_bp.about') }}">
                            <i class="bi bi-info-circle me-1"></i>About
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if request.path == url_for('main_bp.services') %}active{% endif %}" href="{{ url_for('main_bp.services') }}">
                            <i class="bi bi-gear me-1"></i>Services
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#footer">
                            <i class="bi bi-envelope me-1"></i>Contact
                        </a>
                    </li>
                    {% if current_user.is_authenticated and (current_user.role == 'developer' or current_user.role == 'teacher')%}
                    <li class="nav-item">
                        <a class="nav-link {% if request.path == url_for('main_bp.view_all_requests') %}active{% endif %}" href="{{ url_for('main_bp.view_all_requests') }}">
                            <i class="bi bi-eye me-1"></i>View Requests
                        </a>
                    </li>
                    {% endif %}
                </ul>

                {% if current_user.is_authenticated %}
                <form class="d-flex navbar-search mx-auto me-3" action="{{ url_for('main_bp.search_results') }}" method="get">
                    <div class="input-group position-relative">
                        <input id="search-input" class="form-control" type="search" name="query" placeholder="Search clubs by name or teacher" aria-label="Search" autocomplete="off">
                        <button class="btn rounded-end" type="submit">
                            <i class="bi bi-search"></i>
                        </button>
                        <div id="search-suggestions" class="position-absolute mt-1" style="top: 100%; left: 0; z-index: 1000; background-color: var(--surface); border: 1px solid var(--primary); border-radius: 15px; display: none; width: 100%; max-height: 300px; overflow-y: auto; overflow-x: hidden;">
                        </div>
                    </div>
                </form>

                <ul class="navbar-nav d-flex align-items-center ms-auto">
                    <li class="nav-item">
                        <a class="nav-link btn btn-outline-primary text-warning px-3 mx-2" href="{{ url_for('main_bp.poll') }}">
                            <i class="bi bi-ui-checks-grid me-1"></i>Take Survey
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-person-circle me-1"></i>{{ current_user.username }}
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="{{ url_for('profile.profile') }}">Profile</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('profile.settings') }}">Settings</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="{{ url_for('auth.logout') }}">Logout</a></li>
                        </ul>
                    </li>
                </ul>
                {% else %}
                <ul class="navbar-nav ms-auto d-flex align-items-center">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('auth.login') }}">
                            <i class="bi bi-box-arrow-in-right me-1"></i>Login
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link btn btn-primary text-black px-3 mx-2" href="{{ url_for('auth.register') }}">
                            Sign Up
                        </a>
                    </li>
                </ul>
                {% endif %}
            </div>
        </div>
    </nav>

    <main class="py-4" style="padding-top: 80px;">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="container">
                            <div class="alert alert-{{ category if category != 'message' else 'info' }}">
                                {{ message }}
                                {% if category == 'success' %}
                                <span class="close-btn">&times;</span>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

        {% block content %}{% endblock %}
    </main>

<footer id="footer" class="py-5 mt-5" style="background-color: #ffca0c; color: #000;">
  <div class="container d-flex justify-content-center">
    <div class="row w-100 justify-content-center" style="max-width: 1000px; text-align: center;">

      <!-- Contact Info -->
      <div class="col-md-4 mb-4">
        <h5>Contact Us</h5>
        <p>Email: <a href="mailto:EduAlightContact@gmail.com" style="color: #000; text-decoration: underline;">EduAlightContact@gmail.com</a></p>
        <p>Phone: <a href="tel:+359889179179" style="color: #000;">0888 917 917</a></p>
        <p>LinkedIn: <a href="#" style="color: #000;">EduAlight Network</a></p>
        <p>Address: <a href="#" style="color: #000;">123 Innovation Blvd, Sofia</a></p>
        <p>Support Hours: Mon–Fri, 9:00–17:00</p>
      </div>

      <!-- About Section -->
      <div class="col-md-4 mb-4">
        <h5>About EduAlight</h5>
        <p>
          We are building an intelligent web platform using Flask and Python, powered by machine learning, to help students and parents choose the most suitable extracurricular activities. Our mission is to bridge education and technology for real-world impact.
        </p>
      </div>

      <!-- Social Media -->
      <div class="col-md-4 mb-4">
        <h5>Follow Us</h5>
        <ul class="list-unstyled">
          <li class="mb-2">
            <img src="{{ url_for('static', filename='images/instagram.png') }}" alt="Instagram Icon" width="24">
            <a href="https://www.instagram.com/apostolkupenov1" target="_blank" style="color: #000; text-decoration: none;">Instagram</a>
          </li>
          <li class="mb-2">
            <img src="{{ url_for('static', filename='images/facebook.png') }}" alt="Facebook Icon" width="24">
            <a href="https://www.facebook.com/Апостол Купенов" target="_blank" style="color: #000; text-decoration: none;">Facebook</a>
          </li>
          <li class="mb-2">
            <img src="{{ url_for('static', filename='images/tiktok.png') }}" alt="TikTok Icon" width="24">
            <a href="https://www.tiktok.com/@user15395732917" target="_blank" style="color: #000; text-decoration: none;">TikTok</a>
          </li>
          <li class="mb-2">
            <img src="{{ url_for('static', filename='images/youtube.png') }}" alt="YouTube Icon" width="24">
            <a href="https://www.youtube.com/@apo7.7" target="_blank" style="color: #000; text-decoration: none;">YouTube</a>
          </li>
        </ul>
      </div>

    </div>
  </div>

  <!-- Footer Bottom -->
  <div class="text-center pt-4 mt-4" style="font-size: 1.1rem;">
    <p class="mb-0">© 2025 EduAlight. All rights reserved.</p>
  </div>
</footer>





    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listeners to close buttons in alerts
            document.querySelectorAll('.close-btn').forEach(function(closeBtn) {
                closeBtn.addEventListener('click', function() {
                    // Find the parent alert and hide it
                    const alert = this.closest('.alert');
                    if (alert) {
                        alert.style.display = 'none';
                    }
                });
            });
            const searchInput = document.getElementById('search-input');
            const suggestionsContainer = document.getElementById('search-suggestions');

            if (searchInput && suggestionsContainer) {
                let debounceTimer;

                // Function to fetch suggestions
                const fetchSuggestions = (query) => {
                    clearTimeout(debounceTimer);

                    debounceTimer = setTimeout(() => {
                        fetch(`/search-suggestions?query=${encodeURIComponent(query)}`)
                            .then(response => response.json())
                            .then(data => {
                                suggestionsContainer.innerHTML = '';

                                if (data.type === 'no_results') {
                                    // No results found
                                    const noResults = document.createElement('div');
                                    noResults.className = 'p-3 text-center';
                                    noResults.textContent = 'No available suggestions';
                                    suggestionsContainer.appendChild(noResults);
                                    suggestionsContainer.style.display = 'block';
                                } 
                                else if (data.type === 'recent' && data.suggestions.length > 0) {
                                    // Recent searches (show only 2)
                                    const recentHeader = document.createElement('div');
                                    recentHeader.className = 'p-2 text-warning fw-bold';
                                    recentHeader.textContent = 'Recent Searches';
                                    suggestionsContainer.appendChild(recentHeader);

                                    data.suggestions.slice(0,2).forEach(search => {
                                        const item = document.createElement('a');
                                        item.className = 'dropdown-item py-2 px-3';
                                        item.href = `/search?query=${encodeURIComponent(search)}`;
                                        item.textContent = search;
                                        suggestionsContainer.appendChild(item);
                                    });

                                    suggestionsContainer.style.display = 'block';
                                }
                                else if (data.type === 'results') {
                                    // First show matching events if available
                                    if (data.club_events && data.club_events.length > 0) {
                                        const eventsHeader = document.createElement('div');
                                        eventsHeader.className = 'p-2 text-warning fw-bold';
                                        eventsHeader.textContent = 'Upcoming Events';
                                        suggestionsContainer.appendChild(eventsHeader);

                                        data.club_events.forEach(event => {
                                            const eventDiv = document.createElement('a');
                                            eventDiv.className = 'dropdown-item py-2 px-3';
                                            eventDiv.href = `/clubs/${event.club_slug}/event/${event.event_date}`;

                                            const clubNameDiv = document.createElement('div');
                                            clubNameDiv.className = 'fw-bold text-warning';
                                            clubNameDiv.textContent = event.club_name;

                                            const eventDetailsDiv = document.createElement('div');
                                            eventDetailsDiv.className = 'small text-warning';
                                            eventDetailsDiv.textContent = `${event.event_date} - ${event.description || 'No description'}`;

                                            eventDiv.appendChild(clubNameDiv);
                                            eventDiv.appendChild(eventDetailsDiv);
                                            suggestionsContainer.appendChild(eventDiv);
                                        });

                                        // Add a divider between events and clubs if both exist
                                        if (data.suggestions.length > 0) {
                                            const divider = document.createElement('div');
                                            divider.className = 'dropdown-divider my-2';
                                            divider.style.borderTop = '1px solid #ffc10755';
                                            suggestionsContainer.appendChild(divider);
                                        }
                                    }

                                    // Then show club results
                                    if (data.suggestions.length > 0) {
                                        const clubsHeader = document.createElement('div');
                                        clubsHeader.className = 'p-2 text-warning fw-bold';
                                        clubsHeader.textContent = 'Clubs';
                                        suggestionsContainer.appendChild(clubsHeader);

                                        data.suggestions.forEach(club => {
                                            const item = document.createElement('a');
                                            item.className = 'dropdown-item py-2 px-3';
                                            // If user is a member, go to calendar, else go to detail
                                            let isMember = false;
                                            if (window.currentUserClubs && Array.isArray(window.currentUserClubs)) {
                                                isMember = window.currentUserClubs.includes(club.slug);
                                            }
                                            if (isMember) {
                                                item.href = `/clubs/${club.slug}/calendar`;
                                            } else {
                                                item.href = `/clubs/${club.slug}`;
                                            }

                                            const nameSpan = document.createElement('div');
                                            nameSpan.className = 'fw-bold text-warning';
                                            nameSpan.textContent = club.name;

                                            const teacherSpan = document.createElement('div');
                                            teacherSpan.className = 'small text-warning fw-bold';
                                            teacherSpan.textContent = `Teacher: ${club.teacher}`;

                                            item.appendChild(nameSpan);
                                            item.appendChild(teacherSpan);
                                            suggestionsContainer.appendChild(item);
                                        });
                                    }

                                    // If we have either events or clubs, show the container
                                    if (data.club_events.length > 0 || data.suggestions.length > 0) {
                                        suggestionsContainer.style.display = 'block';
                                    }
                                }
                                else {
                                    suggestionsContainer.style.display = 'none';
                                }
                            })
                            .catch(error => {
                                console.error('Error fetching suggestions:', error);
                            });
                    }, 300); // Debounce delay
                };

                // Show recent searches on focus if input is empty
                searchInput.addEventListener('focus', function() {
                    const query = this.value.trim();
                    if (!query) {
                        fetchSuggestions('');
                    } else {
                        fetchSuggestions(query);
                    }
                });

                // Fetch suggestions as user types
                searchInput.addEventListener('input', function() {
                    const query = this.value.trim();
                    fetchSuggestions(query);
                });

                // Close suggestions when clicking outside
                document.addEventListener('click', function(event) {
                    if (!searchInput.contains(event.target) && !suggestionsContainer.contains(event.target)) {
                        suggestionsContainer.style.display = 'none';
                    }
                });

                // Prevent form submission when selecting a suggestion
                suggestionsContainer.addEventListener('click', function(event) {
                    if (event.target.tagName === 'A' || event.target.closest('a')) {
                        event.preventDefault();
                        const link = event.target.tagName === 'A' ? event.target : event.target.closest('a');
                        window.location.href = link.href;
                    }
                });
            }
        });
    </script>

    {% if current_user.is_authenticated %}
    <script>
        // Pass the list of club slugs the user is a member of to JS
        window.currentUserClubs = [
            {% for club in current_user.clubs %}'{{ club.slug }}'{% if not loop.last %}, {% endif %}{% endfor %}
        ];
    </script>
    {% endif %}

    {% block extra_js %}{% endblock %}
</body>
</html>
